<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weatherly - Dashboard</title>
<link rel="stylesheet" href="stylesheet/global.css">
</head>
<body>

<!-- Top Navigation -->
<header class="top-nav">
  <div class="logo">‚òÅÔ∏è<h1>Weatherly</h1></div>
  <nav class="nav-links">
    <a href="saved.html" class="active">Dashboard</a>
    <a href="search.html">Search</a>
    <a href="pastWeather.html">Past Weather</a>
    <a href="weatherAlerts.html">Alerts</a>
    <a href="settings.html">Settings</a>
    <a href="help.html">Help</a>
  </nav>
  <div class="user-section">
    <button onclick="window.location.href='profile.html'" class="profile-btn">Demo User</button>
    <button onclick="window.location.href='login.html'" class="logout-btn">Logout</button>
  </div>
</header>

<main class="main-container">
  <!-- Header -->
  <header class="section-header">
    <h2>My Locations</h2>
    <p id="locationsInfo">Manage your top 3 of 5 saved locations</p>
  </header>

  <!-- Locations Grid -->
  <div id="locationsContainer" class="locations-grid"></div>
</main>

<script>
/* -------- Saved Locations (start with 3) -------- */
let locations = [
  {id:'1', name:'New York', country:'USA', temp:72, condition:'Partly Cloudy', high:75, low:65, humidity:65, windSpeed:12, icon:'‚õÖ'},
  {id:'2', name:'London', country:'UK', temp:61, condition:'Rainy', high:64, low:58, humidity:85, windSpeed:15, icon:'üåßÔ∏è'},
  {id:'3', name:'Tokyo', country:'Japan', temp:68, condition:'Sunny', high:73, low:62, humidity:55, windSpeed:8, icon:'‚òÄÔ∏è'}
];

/* -------- Extra sample (not saved yet) -------- */
let extraSampleLocations = [
  {id:'4', name:'Sydney', country:'Australia', temp:78, condition:'Sunny', high:82, low:70, humidity:45, windSpeed:10, icon:'‚òÄÔ∏è'},
  {id:'5', name:'Toronto', country:'Canada', temp:59, condition:'Cloudy', high:63, low:54, humidity:72, windSpeed:14, icon:'‚òÅÔ∏è'}
];

/* DOM */
const locationsContainer = document.getElementById('locationsContainer');
const locationsInfo = document.getElementById('locationsInfo');

/* Render */
function renderLocations() {
  locationsContainer.innerHTML = '';
  const maxDisplayed = 5;
  const displayedLocations = locations.slice(0, maxDisplayed);

  locationsInfo.textContent = `Your top ${displayedLocations.length} of ${maxDisplayed} saved locations`;

  displayedLocations.forEach(loc => {
    const card = document.createElement('div');
    card.className = 'location-card';
    card.innerHTML = `
      <div class="card-saved">
        <button class="card-close" data-id="${loc.id}" aria-label="Remove ${loc.name}">&times;</button>
        <div class="card-header">
          <div>
            <h3 class="city-name">${loc.name}</h3>
            <p class="country-name">${loc.country}</p>
          </div>
          <div class="loc-icon">${loc.icon}</div>
        </div>

        <div class="card-body">
          <div class="temp-condition">
            <span class="saved-temp">${loc.temp}¬∞</span>
            <span class="saved-condition">${loc.condition}</span>
          </div>
          <div class="saved-high-low">
            <span>H: ${loc.high}¬∞</span>
            <span>L: ${loc.low}¬∞</span>
          </div>
          <div class="card-divider"></div>
          <div class="saved-metrics">
            <div class="saved-metric-item">
              <div class="metric-icon-label">
                <span class="metric-icon">üíß</span>
                <span class="metric-label">Humidity</span>
              </div>
              <span class="metric-value">${loc.humidity}%</span>
            </div>
            <div class="saved-metric-item">
              <div class="metric-icon-label">
                <span class="metric-icon">üå¨Ô∏è</span>
                <span class="metric-label">Wind</span>
              </div>
              <span class="metric-value">${loc.windSpeed} mph</span>
            </div>
          </div>
        </div>
      </div>
    `;

    locationsContainer.appendChild(card);

    const cardSaved = card.querySelector('.card-saved');
    
    // Make card clickable to navigate to weekly forecast
    cardSaved.addEventListener('click', (e) => {
      // Don't navigate if clicking the close button
      if (e.target.classList.contains('card-close') || e.target.closest('.card-close')) {
        return;
      }
      window.location.href = 'weeklyForecast.html';
    });

    // Remove location handler for X button
    const closeBtn = card.querySelector('.card-close');
    if (closeBtn) {
      closeBtn.addEventListener('click', e => {
        e.stopPropagation();
        const id = e.currentTarget.dataset.id;
        locations = locations.filter(l => l.id !== id);
        renderLocations();
      });
    }
  });

  /* ----- Add Location Card (if room) ----- */
  if (locations.length < maxDisplayed) {
    const remaining = maxDisplayed - locations.length;

    const addCard = document.createElement('div');
    addCard.className = 'add-card';
    addCard.innerHTML = `
      <div class="add-content">
        <span class="plus">+</span>
        <p>Add Location</p>
        <small>${remaining} slot${remaining !== 1 ? 's' : ''} remaining</small>
      </div>
    `;

    addCard.addEventListener('click', showSearchBar);
    locationsContainer.appendChild(addCard);
  }
}

/* ---- SHOW SEARCH BAR ---- */
function showSearchBar() {
  const searchWrapper = document.createElement('div');
  searchWrapper.className = 'search-wrapper';

  searchWrapper.innerHTML = `
    <input id="locSearchInput" class="search-input" type="text" placeholder="Search location...">
    <button id="locSearchBtn" class="search-btn">Search</button>
    <p id="searchError" class="search-error" style="color:red;display:none;">Location not found</p>
  `;

  locationsContainer.appendChild(searchWrapper);

  document.getElementById('locSearchBtn').addEventListener('click', handleSearch);
}

/* ---- SEARCH HANDLER ---- */
function handleSearch() {
  const query = document.getElementById('locSearchInput').value.trim().toLowerCase();
  const error = document.getElementById('searchError');

  // Allowed sample location names
  const allowed = extraSampleLocations.map(l => l.name.toLowerCase());

  if (!allowed.includes(query)) {
    error.style.display = 'block';
    return;
  }

  error.style.display = 'none';

  // Find matching location
  const found = extraSampleLocations.find(l => l.name.toLowerCase() === query);

  // Add to saved list
  locations.push(found);

  // Remove from available sample list
  extraSampleLocations = extraSampleLocations.filter(l => l.id !== found.id);

  renderLocations();
}

renderLocations();
</script>

</body>
</html>
