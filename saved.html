<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weatherly - Dashboard</title>
  <link rel="stylesheet" href="stylesheet/global.css">

  <script src="mockData.js"></script>
</head>
<body>

<header class="top-nav">
  <div class="logo">‚òÅÔ∏è<h1 class="title">Weatherly</h1></div>
  <nav class="nav-links">
    <a href="saved.html" class="active">Dashboard</a>
    <a href="search.html">Search</a>
    <a href="pastWeather.html">Past Weather</a>
    <a href="weatherAlerts.html">Alerts</a>
    <a href="settings.html">Settings</a>
    <a href="help.html">Help</a>
  </nav>
  <div class="user-section">
    <button onclick="window.location.href='profile.html'" class="profile-btn">Demo User</button>
    <button onclick="window.location.href='login.html'" class="logout-btn">Logout</button>
  </div>
</header>

<main class="main-container">
  <header class="section-header">
    <h2>My Locations</h2>
    <p id="locationsInfo">Manage your top 3 of 5 saved locations</p>
  </header>

  <button id="resetDemoBtn" class="btn-outline" style="margin-bottom: 20px;">
    Reset Demo Locations
  </button>

  <div id="locationsContainer" class="locations-grid"></div>
</main>

<script>
const MAX_LOCATIONS = 5;
const STORAGE_KEY = 'weatherlySavedLocations';

const defaultDemoLocations = [
  {id:'1', name:'New York', country:'USA', temp:72, condition:'Partly Cloudy', high:75, low:65, humidity:65, windSpeed:12, icon:'‚õÖ'},
  {id:'2', name:'London', country:'UK', temp:61, condition:'Rainy', high:64, low:58, humidity:85, windSpeed:15, icon:'üåßÔ∏è'},
  {id:'3', name:'Tokyo', country:'Japan', temp:68, condition:'Sunny', high:73, low:62, humidity:55, windSpeed:8, icon:'‚òÄÔ∏è'}
];

let locations = JSON.parse(localStorage.getItem(STORAGE_KEY));

if (!locations || !Array.isArray(locations) || locations.length === 0) {
  locations = [...defaultDemoLocations];
  localStorage.setItem(STORAGE_KEY, JSON.stringify(locations));
}

let extraSampleLocations = [
  {id:'4', name:'Sydney', country:'Australia', temp:78, condition:'Sunny', high:82, low:70, humidity:45, windSpeed:10, icon:'‚òÄÔ∏è'},
  {id:'5', name:'Toronto', country:'Canada', temp:59, condition:'Cloudy', high:63, low:54, humidity:72, windSpeed:14, icon:'‚òÅÔ∏è'}
];

const locationsContainer = document.getElementById('locationsContainer');
const locationsInfo = document.getElementById('locationsInfo');
const resetDemoBtn = document.getElementById('resetDemoBtn');

function saveLocations() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(locations));
}

function renderLocations() {
  locationsContainer.innerHTML = '';
  const displayedLocations = locations.slice(0, MAX_LOCATIONS);

  locationsInfo.textContent = `Your top ${displayedLocations.length} of ${MAX_LOCATIONS} saved locations`;

  displayedLocations.forEach(loc => {
    const card = document.createElement('div');
    card.className = 'location-card';
    card.innerHTML = `
      <div class="card-saved">
        <button class="card-close" data-id="${loc.id}" aria-label="Remove ${loc.name}">&times;</button>
        <div class="card-header">
          <div>
            <h3 class="city-name">${loc.name}</h3>
            <p class="country-name">${loc.country}</p>
          </div>
          <div class="loc-icon">${loc.icon}</div>
        </div>

        <div class="card-body">
          <div class="temp-condition">
            <span class="saved-temp">${loc.temp}¬∞</span>
            <span class="saved-condition">${loc.condition}</span>
          </div>
          <div class="saved-high-low">
            <span>H: ${loc.high}¬∞</span>
            <span>L: ${loc.low}¬∞</span>
          </div>
          <div class="card-divider"></div>
          <div class="saved-metrics">
            <div class="saved-metric-item">
              <div class="metric-icon-label">
                <span class="metric-icon">üíß</span>
                <span class="metric-label">Humidity</span>
              </div>
              <span class="metric-value">${loc.humidity}%</span>
            </div>
            <div class="saved-metric-item">
              <div class="metric-icon-label">
                <span class="metric-icon">üå¨Ô∏è</span>
                <span class="metric-label">Wind</span>
              </div>
              <span class="metric-value">${loc.windSpeed} mph</span>
            </div>
          </div>
        </div>
      </div>
    `;

    locationsContainer.appendChild(card);

    const cardSaved = card.querySelector('.card-saved');

    cardSaved.addEventListener('click', (e) => {
      if (e.target.classList.contains('card-close') || e.target.closest('.card-close')) {
        return;
      }

      const currentWeather = {
        location: `${loc.name}, ${loc.country}`,
        temp: loc.temp,
        condition: loc.condition,
        high: loc.high,
        low: loc.low,
        humidity: loc.humidity,
        wind: loc.windSpeed,
        icon: loc.icon
      };

      const weeklyForecast = [
        { day: "Mon", high: loc.high,     low: loc.low,     condition: loc.condition,         icon: loc.icon },
        { day: "Tue", high: loc.high+1,   low: loc.low-1,   condition: "Partly Cloudy",       icon: "‚õÖ" },
        { day: "Wed", high: loc.high+2,   low: loc.low,     condition: "Light Rain",          icon: "üåßÔ∏è" },
        { day: "Thu", high: loc.high-1,   low: loc.low-2,   condition: "Thunderstorm",        icon: "‚õàÔ∏è" },
        { day: "Fri", high: loc.high,     low: loc.low-1,   condition: "Sunny",               icon: "‚òÄÔ∏è" },
        { day: "Sat", high: loc.high-2,   low: loc.low-3,   condition: "Partly Cloudy",       icon: "‚õÖ" },
        { day: "Sun", high: loc.high-1,   low: loc.low-2,   condition: "Sunny",               icon: "‚òÄÔ∏è" }
      ];

      localStorage.setItem('selectedLocationWeather', JSON.stringify(currentWeather));
      localStorage.setItem('selectedLocationWeekly', JSON.stringify(weeklyForecast));

      window.location.href = 'weeklyForecast.html';
    });

    const closeBtn = card.querySelector('.card-close');
    if (closeBtn) {
      closeBtn.addEventListener('click', e => {
        e.stopPropagation();
        const id = e.currentTarget.dataset.id;
        locations = locations.filter(l => l.id !== id);
        saveLocations();
        renderLocations();
      });
    }

  });

  if (locations.length < MAX_LOCATIONS) {
    const remaining = MAX_LOCATIONS - locations.length;

    const addCard = document.createElement('div');
    addCard.className = 'add-card';
    addCard.innerHTML = `
      <div class="add-content">
        <span class="plus">+</span>
        <p>Add Location</p>
        <small>${remaining} slot${remaining !== 1 ? 's' : ''} remaining</small>
      </div>
    `;

    addCard.addEventListener('click', () => {
      window.location.href = 'search.html';
    });
    locationsContainer.appendChild(addCard);
  }

  saveLocations();
}

function showSearchBar() {
  const existing = document.querySelector('.search-wrapper');
  if (existing) return;

  const searchWrapper = document.createElement('div');
  searchWrapper.className = 'search-wrapper';

  searchWrapper.innerHTML = `
    <input id="locSearchInput" class="search-input" type="text" placeholder="Search location...">
    <button id="locSearchBtn" class="search-btn">Search</button>
    <p id="searchError" class="search-error" style="color:red;display:none;">Location not found</p>
  `;

  locationsContainer.appendChild(searchWrapper);

  document.getElementById('locSearchBtn').addEventListener('click', handleSearch);
}

function handleSearch() {
  const query = document.getElementById('locSearchInput').value.trim().toLowerCase();
  const error = document.getElementById('searchError');

  const allowed = extraSampleLocations.map(l => l.name.toLowerCase());

  if (!allowed.includes(query)) {
    error.textContent = 'Location not found';
    error.style.display = 'block';
    return;
  }

  if (locations.length >= MAX_LOCATIONS) {
    error.textContent = 'You can only save up to 5 locations.';
    error.style.display = 'block';
    return;
  }

  error.style.display = 'none';

  const found = extraSampleLocations.find(l => l.name.toLowerCase() === query);

  if (locations.some(l => l.id === found.id)) {
    error.textContent = 'This location is already saved.';
    error.style.display = 'block';
    return;
  }

  locations.push(found);
  extraSampleLocations = extraSampleLocations.filter(l => l.id !== found.id);

  saveLocations();
  renderLocations();
}

resetDemoBtn.addEventListener('click', () => {
  if (!confirm('Reset to default demo locations?')) return;

  locations = [...defaultDemoLocations];
  localStorage.setItem(STORAGE_KEY, JSON.stringify(locations));
  renderLocations();
  alert('Dashboard reset to demo defaults!');
});

renderLocations();
</script>

</body>
</html>


