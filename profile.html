<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weatherly - Profile</title>

  <!-- Global + Page Styles -->
  <link rel="stylesheet" href="stylesheet/global.css">
  <link rel="stylesheet" href="stylesheet/profile.css">
</head>

<body>

<!-- Top Navigation -->
<header class="top-nav">
  <div class="logo">
    <span class="logo-icon">â˜ï¸</span>
    <h1 class="title">Weatherly</h1>
  </div>
  <nav class="nav-links">
    <a href="saved.html">Dashboard</a>
    <a href="search.html">Search</a>
    <a href="pastWeather.html">Past Weather</a>
    <a href="weatherAlerts.html">Alerts</a>
    <a href="settings.html">Settings</a>
    <a href="help.html">Help</a>
  </nav>

  <div class="user-section">
    <button onclick="window.location.href='profile.html'" class="profile-btn active">Demo User</button>
    <button onclick="window.location.href='login.html'" class="logout-btn">Logout</button>
  </div>
</header>

<!-- MAIN PAGE CONTENT -->
<main class="main-container">

  <header class="section-header">
    <h1>My Profile</h1>
    <p>Manage your account information and preferences</p>
  </header>

  <!-- GRID LAYOUT -->
  <div class="main-grid">

    <!-- PROFILE CARD -->
    <div class="profile-card card">
      <div class="profile-header">
        <div class="avatar"><span class="user-icon">ğŸ‘¤</span></div>

        <div class="user-info">
          <h3 id="userName">User Name</h3>
          <p id="userEmail">user@example.com</p>
          <span class="badge">Active Account</span>
        </div>

        <button id="editProfileBtn" class="edit-btn">âœï¸ Edit</button>
      </div>

      <!-- EDIT SECTION -->
      <div id="editSection" class="edit-section">
        <label>Full Name</label>
        <input type="text" id="editName">

        <label>Email</label>
        <input type="email" id="editEmail">

        <div class="edit-actions">
          <button id="saveBtn">ğŸ’¾ Save</button>
          <button id="cancelBtn" class="cancel">Cancel</button>
        </div>
      </div>

      <!-- DETAILS -->
      <div class="profile-details">
        <div class="detail-item">
          <div class="icon">âœ‰ï¸</div>
          <div>
            <div class="label">Email</div>
            <div id="detailEmail"></div>
          </div>
        </div>

        <div class="detail-item">
          <div class="icon">ğŸ“…</div>
          <div>
            <div class="label">Member Since</div>
            <div id="memberSince"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- STATS CARD -->
    <div class="stats-card card">
      <h3>Account Stats</h3>

      <div class="stat-item">
        <div class="icon">ğŸ“</div>
        <span>Saved Locations:</span>
        <span id="savedLocations">0</span>
      </div>

      <div class="stat-item">
        <div class="icon">ğŸ“…</div>
        <span>Days Active:</span>
        <span id="daysActive">0</span>
      </div>
    </div>

    <!-- DANGER ZONE -->
    <div class="danger-card card">
      <h3>Danger Zone</h3>
      <p>This action is permanent. Proceed with caution.</p>
      <button id="deleteAccountBtn" class="destructive-btn">ğŸ—‘ï¸ Delete Account</button>
    </div>

    <!-- PRO TIP -->
    <div class="pro-tip-card card">
      <h3>Pro Tip</h3>
      <p>Enable notifications in Settings to get severe weather alerts faster.</p>
    </div>

  </div>
</main>

<!-- SCRIPT -->
<script>
  const user = JSON.parse(localStorage.getItem("currentUser")) || {
    id: 1,
    name: "John Doe",
    email: "john@example.com",
    createdAt: "2023-01-01T00:00:00Z"
  };

  // UPDATED: use same key as dashboard
  const getSavedLocationsCount = () => {
    const data = localStorage.getItem("weatherlySavedLocations");
    return data ? JSON.parse(data).length : 0;
  };

  const userName = document.getElementById("userName");
  const userEmail = document.getElementById("userEmail");
  const detailEmail = document.getElementById("detailEmail");
  const memberSince = document.getElementById("memberSince");
  const savedLocations = document.getElementById("savedLocations");
  const daysActive = document.getElementById("daysActive");

  const editSection = document.getElementById("editSection");
  const editProfileBtn = document.getElementById("editProfileBtn");
  const editName = document.getElementById("editName");
  const editEmail = document.getElementById("editEmail");
  const saveBtn = document.getElementById("saveBtn");
  const cancelBtn = document.getElementById("cancelBtn");
  const deleteAccountBtn = document.getElementById("deleteAccountBtn");

  function formatDate(dateStr) {
    const d = new Date(dateStr);
    return d.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric"
    });
  }

  function updateUI() {
    userName.textContent = user.name;
    userEmail.textContent = user.email;
    detailEmail.textContent = user.email;
    memberSince.textContent = formatDate(user.createdAt);
    savedLocations.textContent = getSavedLocationsCount();
    daysActive.textContent = Math.floor((Date.now() - new Date(user.createdAt)) / (1000*60*60*24));
  }

  // EDIT BUTTON TOGGLE
  editProfileBtn.onclick = () => {
    editSection.classList.toggle("show");
    editName.value = user.name;
    editEmail.value = user.email;
  };

  saveBtn.onclick = () => {
    user.name = editName.value;
    user.email = editEmail.value;

    const users = JSON.parse(localStorage.getItem("users")) || [];
    const updated = users.map(u => u.id === user.id ? user : u);

    localStorage.setItem("users", JSON.stringify(updated));
    localStorage.setItem("currentUser", JSON.stringify(user));

    editSection.classList.remove("show");
    updateUI();
    alert("Profile updated successfully!");
  };

  cancelBtn.onclick = () => editSection.classList.remove("show");

  // DELETE ACCOUNT
  deleteAccountBtn.onclick = () => {
    if (!confirm("This action cannot be undone. Are you sure?")) return;

    let users = JSON.parse(localStorage.getItem("users")) || [];
    users = users.filter(u => u.id !== user.id);

    localStorage.setItem("users", JSON.stringify(users));
    localStorage.removeItem("currentUser");
    localStorage.removeItem("locations_" + user.id);

    alert("Account deleted.");
    window.location.href = "login.html";
  };

  updateUI();
</script>
<script src="accessibility.js"></script>
</body>
</html>
