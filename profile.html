<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weatherly - Profile</title>
  <link rel="stylesheet" href="profile.css">
</head>
<body>

  <button id="backBtn" class="btn-ghost" onclick="window.location.href='saved.html'">
    â† Back to Dashboard
  </button>

  <div class="container">

    <h2>My Profile</h2>
    <p>Manage your account information and preferences</p>

    <div class="main-grid">

      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-header">
          <div class="avatar">
            <span class="user-icon">ğŸ‘¤</span>
          </div>
          <div class="user-info">
            <h3 id="userName">User Name</h3>
            <p id="userEmail">user@example.com</p>
            <span class="badge">Active Account</span>
          </div>
          <button id="editProfileBtn">âœï¸ Edit Profile</button>
        </div>

        <div id="editSection" class="edit-section hidden">
          <label for="editName">Full Name</label>
          <input type="text" id="editName">
          
          <label for="editEmail">Email Address</label>
          <input type="email" id="editEmail">

          <div class="edit-actions">
            <button id="saveBtn">ğŸ’¾ Save Changes</button>
            <button id="cancelBtn">âŒ Cancel</button>
          </div>
        </div>

        <div class="profile-details">
          <div class="detail-item">
            <div class="icon">âœ‰ï¸</div>
            <div>
              <div class="label">Email</div>
              <div id="detailEmail"></div>
            </div>
          </div>

          <div class="detail-item">
            <div class="icon">ğŸ“…</div>
            <div>
              <div class="label">Member Since</div>
              <div id="memberSince"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="danger-card">
        <h3>Danger Zone</h3>
        <p>Deleting your account is permanent and cannot be undone.</p>
        <button id="deleteAccountBtn" class="destructive-btn">ğŸ—‘ï¸ Delete Account</button>
      </div>

      <!-- Stats Sidebar -->
      <div class="stats-card">
        <h3>Account Stats</h3>
        <div class="stat-item">
          <div class="icon">ğŸ“</div>
          <span>Saved Locations:</span>
          <span id="savedLocations">0</span>
        </div>
        <div class="stat-item">
          <div class="icon">ğŸ“…</div>
          <span>Days Active:</span>
          <span id="daysActive">0</span>
        </div>
      </div>

      <div class="pro-tip-card">
        <h3>Pro Tip</h3>
        <p>Enable notifications in Settings to receive severe weather alerts for your saved locations.</p>
      </div>

    </div>
  </div>

  <script>
    // Sample user data (simulate fetching from localStorage)
    const user = JSON.parse(localStorage.getItem('currentUser')) || {
      id: 1,
      name: "John Doe",
      email: "john@example.com",
      createdAt: "2023-01-01T00:00:00Z"
    };

    const getSavedLocationsCount = () => {
      const data = localStorage.getItem('locations_' + user.id);
      return data ? JSON.parse(data).length : 0;
    };

    // Elements
    const userName = document.getElementById('userName');
    const userEmail = document.getElementById('userEmail');
    const detailEmail = document.getElementById('detailEmail');
    const memberSince = document.getElementById('memberSince');
    const savedLocations = document.getElementById('savedLocations');
    const daysActive = document.getElementById('daysActive');

    const editProfileBtn = document.getElementById('editProfileBtn');
    const editSection = document.getElementById('editSection');
    const editName = document.getElementById('editName');
    const editEmail = document.getElementById('editEmail');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function updateProfileDisplay() {
      userName.textContent = user.name;
      userEmail.textContent = user.email;
      detailEmail.textContent = user.email;
      memberSince.textContent = formatDate(user.createdAt);
      savedLocations.textContent = getSavedLocationsCount();
      daysActive.textContent = Math.floor((Date.now() - new Date(user.createdAt).getTime()) / (1000*60*60*24));
    }

    editProfileBtn.addEventListener('click', () => {
      editSection.classList.remove('hidden');
      editName.value = user.name;
      editEmail.value = user.email;
    });

    saveBtn.addEventListener('click', () => {
      user.name = editName.value;
      user.email = editEmail.value;

      // Save to localStorage
      const usersData = localStorage.getItem('users');
      let users = usersData ? JSON.parse(usersData) : [];
      users = users.map(u => u.id === user.id ? user : u);
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('currentUser', JSON.stringify(user));

      editSection.classList.add('hidden');
      updateProfileDisplay();
      alert("Profile updated successfully!");
    });

    cancelBtn.addEventListener('click', () => {
      editSection.classList.add('hidden');
    });

    deleteAccountBtn.addEventListener('click', () => {
      if(confirm("Are you sure you want to delete your account? This cannot be undone.")) {
        const usersData = localStorage.getItem('users');
        let users = usersData ? JSON.parse(usersData) : [];
        users = users.filter(u => u.id !== user.id);
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.removeItem(`locations_${user.id}`);
        localStorage.removeItem('currentUser');
        alert("Account deleted.");
        location.reload();
      }
    });

    updateProfileDisplay();
  </script>
</body>
</html>
