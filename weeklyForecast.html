<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weekly Forecast</title>
<link rel="stylesheet" href="stylesheet/weekly.css" />
<!-- SHARED MOCK DATA INITIALIZER -->
<script src="mockData.js"></script>
</head>

<body>
  <!-- Top Navigation -->
<header class="top-nav">
  <div class="logo">â˜ï¸<h1 class="title">Weatherly</h1></div>
  <nav class="nav-links">
    <a href="saved.html" class="active">Dashboard</a>
    <a href="search.html">Search</a>
    <a href="pastWeather.html">Past Weather</a>
    <a href="weatherAlerts.html">Alerts</a>
    <a href="settings.html">Settings</a>
    <a href="help.html">Help</a>
  </nav>
  <div class="user-section">
    <button onclick="window.location.href='profile.html'" class="profile-btn">Demo User</button>
    <button onclick="window.location.href='login.html'" class="logout-btn">Logout</button>
  </div>
</header>

<button id="backBtn" class="btn-ghost" onclick="window.location.href='saved.html'">
    â† Back to Dashboard
  </button>

  <div class="main-container">

    <!-- Header -->
    <div class="header">
      <h2>7-Day Forecast</h2>
      <p id="locationInfo"></p>
    </div>

    <!-- Current Weather Summary -->
    <div class="card current-weather">
      <div class="current-info" style="display:flex; justify-content:space-between; align-items:center;">
        
        <div class="weather-left">
          <p class="label">Current Weather</p>
          <div class="temp-row" style="display:flex; gap:12px; align-items:center;">
            <span id="temp" class="temperature"></span>
            <span id="condition" class="condition-text"></span>
          </div>
          <div class="weather-details">
            <span id="high"></span>
            <span id="low"></span>
            <span id="humidity" class="hide-on-mobile"></span>
            <span id="wind" class="hide-on-mobile"></span>
          </div>
          <div class="weather-details mobile-only">
            <span id="humidityMobile"></span>
            <span id="windMobile"></span>
          </div>
        </div>

        <div id="weatherIcon" class="weather-icon" style="font-size:48px;">â˜€ï¸</div>
      </div>
    </div>

    <!-- Weekly Forecast Grid -->
    <div id="weeklyGrid" class="results-grid"></div>

  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {

    // Retrieve selected location data
    const currentWeather = JSON.parse(localStorage.getItem("selectedLocationWeather")) || {
      location: "New York, NY",
      temp: 75,
      condition: "Sunny",
      high: 78,
      low: 68,
      humidity: 55,
      wind: 10,
      icon: "â˜€ï¸"
    };

    const weeklyForecast = JSON.parse(localStorage.getItem("selectedLocationWeekly")) || [
      { day: "Mon", high: 78, low: 65, condition: "Sunny", icon: "â˜€ï¸" },
      { day: "Tue", high: 80, low: 66, condition: "Cloudy", icon: "â˜ï¸" },
      { day: "Wed", high: 82, low: 68, condition: "Rain", icon: "ğŸŒ§ï¸" },
      { day: "Thu", high: 79, low: 67, condition: "Thunderstorm", icon: "â›ˆï¸" },
      { day: "Fri", high: 77, low: 65, condition: "Sunny", icon: "â˜€ï¸" },
      { day: "Sat", high: 76, low: 64, condition: "Partly Cloudy", icon: "â›…" },
      { day: "Sun", high: 75, low: 63, condition: "Sunny", icon: "â˜€ï¸" }
    ];

    // Populate current weather
    // Populate current weather
    document.getElementById("locationInfo").textContent = currentWeather.location;
    document.getElementById("temp").textContent = `${convertTemp(currentWeather.temp)}Â°${tempUnit}`;
    document.getElementById("condition").textContent = currentWeather.condition;
    document.getElementById("high").innerHTML = `H: <span class="high-temp">${convertTemp(currentWeather.high)}Â°${tempUnit}</span>`;
    document.getElementById("low").innerHTML  = `L: <span class="low-temp">${convertTemp(currentWeather.low)}Â°${tempUnit}</span>`;
    document.getElementById("humidity").textContent = `Humidity: ${currentWeather.humidity}%`;
    document.getElementById("wind").textContent = `Wind: ${currentWeather.wind} mph`;
    document.getElementById("humidityMobile").textContent = `Humidity: ${currentWeather.humidity}%`;
    document.getElementById("windMobile").textContent = `Wind: ${currentWeather.wind} mph`;
    document.getElementById("weatherIcon").textContent = currentWeather.icon;

    // Populate weekly forecast
    const weeklyGrid = document.getElementById("weeklyGrid");

    weeklyForecast.forEach(day => {
      const card = document.createElement("div");
      card.className = "day-card";

      card.innerHTML = `
        <p class="day">${day.day}</p>
        <div class="icon">${day.icon}</div>
        <p class="condition">${day.condition}</p>
        <p class="temp">H: <span class="high-temp">${convertTemp(day.high)}</span>Â°${tempUnit} / L: <span class="low-temp">${convertTemp(day.low)}</span>Â°${tempUnit}</p>
        <span class="arrow">âœ</span>
      `;

      // --- Function to save + navigate ---
      const navigateToDaily = () => {
        const selectedDay = { ...day, location: currentWeather.location };
        localStorage.setItem("selectedDayForecast", JSON.stringify(selectedDay));
        window.location.href = "dailyForecast.html";
      };

      // Make entire card clickable
      card.addEventListener("click", navigateToDaily);

      // Arrow click (does not trigger card click twice)
      const arrow = card.querySelector(".arrow");
      arrow.addEventListener("click", (event) => {
        event.stopPropagation();
        navigateToDaily();
      });

      weeklyGrid.appendChild(card);
    });
  });

  /* ---------------- Temperature Unit Conversion ---------------- */
const tempUnit = JSON.parse(localStorage.getItem('userSettings'))?.unit || 'F';

function convertTemp(temp) {
  return tempUnit === 'F' ? temp : Math.round((temp - 32) * 5 / 9);
}

// Update displayed temps
document.querySelectorAll('.temp').forEach(el => {
  el.textContent = convertTemp(parseInt(el.textContent)) + 'Â°' + tempUnit;
});
document.querySelectorAll('.hour-temp').forEach(el => {
  el.textContent = convertTemp(parseInt(el.textContent)) + 'Â°' + tempUnit;
});
document.querySelectorAll('.high-low').forEach(el => {
  el.innerHTML = el.innerHTML.replace(/H: (\d+)Â°/, (_, val) => `H: ${convertTemp(+val)}Â°${tempUnit}`)
                             .replace(/L: (\d+)Â°/, (_, val) => `L: ${convertTemp(+val)}Â°${tempUnit}`);
});

</script>

</body>
</html>

