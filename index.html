<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weatherly</title>
<link rel="stylesheet" href="index.css">
</head>
<body>
<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <span class="logo">‚òÅÔ∏è</span>
      <h1>Weatherly</h1>
    </div>
    <div class="header-right">
      <div id="userInfo" class="user-info">
        <div id="userName">User Name</div>
        <div id="userEmail">user@example.com</div>
      </div>
      <button id="profileBtn" class="btn">Profile</button>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </header>

  <!-- Navigation -->
  <nav id="navBar" class="nav-bar">
    <button class="nav-btn" data-view="dashboard" src="/components/saved.html">Dashboard</button>
    <button class="nav-btn" data-view="search" src="/components/search.html">Search</button>
    <button class="nav-btn" data-view="past" src="components/pastWeather.html">Past Weather</button>
    <button class="nav-btn" data-view="alerts" src="components/weatherAlerts.html">Alerts</button>
    <button class="nav-btn" data-view="settings" src="components/settings.html">Settings</button>
    <button class="nav-btn" data-view="help" src="components/help.html">Help</button>
  </nav>

  <!-- Main Content -->
  <main id="mainContent" class="main-content">
    <!-- Dynamic content loaded here -->
  </main>

<script>
/* State */
let state = {
  isAuthenticated: false,
  currentUser: null,
  currentView: 'dashboard',
  savedLocations: [],
  selectedLocation: null
};

/* Sample Data */
const defaultUser = {id:'1', name:'John Doe', email:'john@example.com'};
const defaultLocations = [
  {id:'1', name:'New York', country:'USA', temp:72, condition:'Partly Cloudy', high:75, low:65, humidity:65, windSpeed:12, icon:'‚õÖ'},
  {id:'2', name:'London', country:'UK', temp:61, condition:'Rainy', high:64, low:58, humidity:85, windSpeed:15, icon:'üåßÔ∏è'},
  {id:'3', name:'Tokyo', country:'Japan', temp:68, condition:'Sunny', high:73, low:62, humidity:55, windSpeed:8, icon:'‚òÄÔ∏è'}
];

/* DOM Elements */
const mainContent = document.getElementById('mainContent');
const userName = document.getElementById('userName');
const userEmail = document.getElementById('userEmail');
const profileBtn = document.getElementById('profileBtn');
const logoutBtn = document.getElementById('logoutBtn');
const navButtons = document.querySelectorAll('.nav-btn');

/* Functions */
function loginUser(user) {
  state.isAuthenticated = true;
  state.currentUser = user;
  state.savedLocations = defaultLocations;
  renderApp();
}

function logoutUser() {
  state.isAuthenticated = false;
  state.currentUser = null;
  state.savedLocations = [];
  state.currentView = 'dashboard';
  renderApp();
}

function setView(view) {
  state.currentView = view;
  renderMainContent();
}

function renderLoginPage() {
  fetch('./components/login.html') // adjust the path
    .then(response => response.text())
    .then(html => {
      mainContent.innerHTML = html;

      // Add event listener for login button
      const loginBtn = document.getElementById('loginBtn');
      if (loginBtn) {
        loginBtn.addEventListener('click', () => loginUser(defaultUser));
      }
    })
    .catch(err => {
      mainContent.innerHTML = `<p>Error loading login page.</p>`;
      console.error(err);
    });
}


function renderApp() {
  if (!state.isAuthenticated) {
    renderLoginPage(); // use fetch-based function
    return;
  }

  // Update header info and render main content for logged-in users
  userName.textContent = state.currentUser.name;
  userEmail.textContent = state.currentUser.email;
  renderMainContent();
}


/* Function to load component HTML (even if it has <html> and <body>) */
function loadComponentHTML(filePath){
  return fetch(filePath)
    .then(res => res.text())
    .then(htmlText => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlText, 'text/html');
      return doc.body.innerHTML; // Only get the body content
    });
}

function renderMainContent(){
  const viewMap = {
    dashboard: '/components/saved.html',
    search: '/components/search.html',
    past: '/components/pastWeather.html',
    alerts: '/components/weatherAlerts.html',
    settings: '/components/settings.html',
    help: '/components/help.html',
    profile: '/components/profilePage.html',
    weekly: '/components/weeklyForecast.html',
    daily: '/components/dailyForecast.html'
  };

  const filePath = viewMap[state.currentView];

  if(!state.isAuthenticated){
    mainContent.innerHTML = '<p>Please login first.</p>';
    return;
  }

  if(state.currentView === 'weekly' && state.selectedLocation){
  fetch('./components/weeklyforecast.html') // adjust path to your file
    .then(response => response.text())
    .then(html => {
      mainContent.innerHTML = html;

      // Add dynamic content (e.g., location name)
      const title = mainContent.querySelector('#weeklyTitle');
      if(title) title.textContent = `Weekly Forecast for ${state.selectedLocation.name}`;

      // Back button
      const backBtn = mainContent.querySelector('#backDashboardBtn');
      if(backBtn) backBtn.addEventListener('click', () => {
        state.currentView = 'dashboard';
        renderMainContent();
      });
    })
    .catch(err => {
      mainContent.innerHTML = `<p>Error loading weekly forecast.</p>`;
      console.error(err);
    });

  return;
}


  // Load HTML component dynamically
  loadComponentHTML(filePath)
    .then(content => mainContent.innerHTML = content)
    .catch(err => {
      mainContent.innerHTML = `<p>Error loading page: ${state.currentView}</p>`;
      console.error(err);
    });
}

/* Event Listeners */
profileBtn.addEventListener('click', ()=>setView('profile'));
logoutBtn.addEventListener('click', logoutUser);
navButtons.forEach(btn=>{
  btn.addEventListener('click', e=>{
    setView(e.currentTarget.dataset.view);
  });
});

/* Initial Render */
renderApp();
</script>
</body>
</html>
