<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weatherly</title>
<link rel="stylesheet" href="index.css">
<style>
  /* Minimal inline CSS for welcome page visibility */
  .hidden { display: none; }
  .progress-dot { display: inline-block; width: 10px; height: 10px; margin: 0 3px; border-radius: 50%; background-color: #ccc; }
  .progress-dot.active { background-color: #007bff; }
</style>
</head>
<body>
<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <span class="logo">‚òÅÔ∏è</span>
      <h1>Weatherly</h1>
    </div>
    <div class="header-right">
      <div id="userInfo" class="user-info">
        <div id="userName">User Name</div>
        <div id="userEmail">user@example.com</div>
      </div>
      <button id="profileBtn" class="btn">Profile</button>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </header>

  <!-- Navigation -->
  <nav id="navBar" class="nav-bar">
    <button class="nav-btn" data-view="dashboard">Dashboard</button>
    <button class="nav-btn" data-view="search">Search</button>
    <button class="nav-btn" data-view="past">Past Weather</button>
    <button class="nav-btn" data-view="alerts">Alerts</button>
    <button class="nav-btn" data-view="settings">Settings</button>
    <button class="nav-btn" data-view="help">Help</button>
  </nav>

  <!-- Main Content -->
  <main id="mainContent" class="main-content">
    <!-- Dynamic content loaded here -->
  </main>
</div>

<script>
/* ---------- State ---------- */
let state = {
  isAuthenticated: false,
  currentUser: null,
  currentView: 'dashboard',
  savedLocations: [],
  selectedLocation: null,
  hasSeenWelcome: localStorage.getItem('hasSeenWelcome') === 'true'
};

/* Sample Data */
const defaultUser = {id:'1', name:'John Doe', email:'john@example.com'};
const defaultLocations = [
  {id:'1', name:'New York', country:'USA', temp:72, condition:'Partly Cloudy', high:75, low:65, humidity:65, windSpeed:12, icon:'‚õÖ'},
  {id:'2', name:'London', country:'UK', temp:61, condition:'Rainy', high:64, low:58, humidity:85, windSpeed:15, icon:'üåßÔ∏è'},
  {id:'3', name:'Tokyo', country:'Japan', temp:68, condition:'Sunny', high:73, low:62, humidity:55, windSpeed:8, icon:'‚òÄÔ∏è'}
];

/* ---------- DOM Elements ---------- */
const mainContent = document.getElementById('mainContent');
const userName = document.getElementById('userName');
const userEmail = document.getElementById('userEmail');
const profileBtn = document.getElementById('profileBtn');
const logoutBtn = document.getElementById('logoutBtn');
const navButtons = document.querySelectorAll('.nav-btn');

/* ---------- Helper Functions ---------- */
function loginUser(user) {
  state.isAuthenticated = true;
  state.currentUser = user;
  state.savedLocations = defaultLocations;
  renderApp();
}

function logoutUser() {
  state.isAuthenticated = false;
  state.currentUser = null;
  state.savedLocations = [];
  state.currentView = 'dashboard';
  renderApp();
}

function setView(view) {
  state.currentView = view;
  renderMainContent();
}

function loadComponentHTML(filePath) {
  return fetch(filePath)
    .then(res => res.text())
    .then(htmlText => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlText, 'text/html');
      return doc.body.innerHTML;
    });
}

/* ---------- Welcome Page ---------- */
function renderWelcomePage() {
  const steps = [
    { title: "Welcome to Weatherly", description: "Your personalized weather dashboard is just a few steps away.", icon: "‚òÄÔ∏è" },
    { title: "Track Your Locations", description: "Save multiple locations to see forecasts quickly.", icon: "üìç" },
    { title: "Stay Alert", description: "Get notified of severe weather and temperature changes.", icon: "‚ö°" },
    { title: "Explore Features", description: "Access 7-day forecasts, historical data, and customizable settings.", icon: "üß≠", showFeatures: true }
  ];

  let currentStep = 0;

  mainContent.innerHTML = `
    <div class="welcome-container">
      <div id="progress" class="progress-container"></div>
      <div class="content-center">
        <div id="iconContainer" class="icon-wrapper"></div>
        <h2 id="stepTitle" class="step-title"></h2>
        <p id="stepDescription" class="step-description"></p>
      </div>
      <div id="featureGrid" class="feature-grid hidden">
        <div class="feature-card blue-card"><h4>7-Day Forecasts</h4><p>Detailed weekly weather predictions</p></div>
        <div class="feature-card purple-card"><h4>Weather Alerts</h4><p>Real-time severe weather warnings</p></div>
        <div class="feature-card green-card"><h4>Historical Data</h4><p>Compare past weather trends</p></div>
        <div class="feature-card orange-card"><h4>Customizable</h4><p>Personalize your experience</p></div>
      </div>
      <div class="nav-container">
        <div><button id="prevBtn" class="nav-btn hidden">&larr; Previous</button></div>
        <div class="nav-right">
          <button id="skipBtn" class="nav-btn">Skip</button>
          <button id="nextBtn" class="next-btn">Next &rarr;</button>
        </div>
      </div>
      <div id="stepCounter" class="step-counter"></div>
    </div>
  `;

  const stepTitle = document.getElementById("stepTitle");
  const stepDescription = document.getElementById("stepDescription");
  const iconContainer = document.getElementById("iconContainer");
  const featureGrid = document.getElementById("featureGrid");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const skipBtn = document.getElementById("skipBtn");
  const stepCounter = document.getElementById("stepCounter");
  const progress = document.getElementById("progress");

  function renderStep() {
    const step = steps[currentStep];
    stepTitle.textContent = step.title;
    stepDescription.textContent = step.description;
    iconContainer.textContent = step.icon;
    featureGrid.classList.toggle("hidden", !step.showFeatures);
    prevBtn.classList.toggle("hidden", currentStep === 0);
    nextBtn.textContent = currentStep === steps.length - 1 ? "Finish" : "Next";
    stepCounter.textContent = `Step ${currentStep + 1} of ${steps.length}`;

    progress.innerHTML = "";
    steps.forEach((_, i) => {
      const dot = document.createElement("span");
      dot.className = "progress-dot";
      if(i === currentStep) dot.classList.add("active");
      progress.appendChild(dot);
    });
  }

  prevBtn.addEventListener("click", () => {
    if(currentStep > 0) { currentStep--; renderStep(); }
  });

  nextBtn.addEventListener("click", () => {
    if(currentStep < steps.length - 1) { currentStep++; renderStep(); }
    else {
      state.hasSeenWelcome = true;
      localStorage.setItem('hasSeenWelcome', 'true');
      renderLoginPage(); // show login AFTER welcome
    }
  });

  skipBtn.addEventListener("click", () => {
    state.hasSeenWelcome = true;
    localStorage.setItem('hasSeenWelcome', 'true');
    renderLoginPage();
  });

  renderStep();
}

/* ---------- Login Page ---------- */
function renderLoginPage() {
  mainContent.innerHTML = `
    <div class="login-page">
      <h2>Login</h2>
      <button id="loginBtn">Login as John Doe</button>
    </div>
  `;
  document.getElementById('loginBtn').addEventListener('click', () => loginUser(defaultUser));
}

/* ---------- Render Main Content ---------- */
function renderMainContent() {
  const viewMap = {
    dashboard: 'components/saved.html',
    search: 'components/search.html',
    past: 'components/pastWeather.html',
    alerts: 'components/weatherAlerts.html',
    settings: 'components/settings.html',
    help: 'components/help.html',
    profile: 'components/profilePage.html',
    weekly: 'components/weeklyForecast.html',
    daily: 'components/dailyForecast.html'
  };

  if(!state.isAuthenticated) {
    mainContent.innerHTML = '<p>Please login first.</p>';
    return;
  }

  const filePath = viewMap[state.currentView];

  // Special case for weekly view with selected location
  if(state.currentView === 'weekly' && state.selectedLocation) {
    fetch('components/weeklyForecast.html')
      .then(res => res.text())
      .then(html => {
        mainContent.innerHTML = html;
        const title = mainContent.querySelector('#weeklyTitle');
        if(title) title.textContent = `Weekly Forecast for ${state.selectedLocation.name}`;
        const backBtn = mainContent.querySelector('#backDashboardBtn');
        if(backBtn) backBtn.addEventListener('click', () => { state.currentView='dashboard'; renderMainContent(); });
      });
    return;
  }

  loadComponentHTML(filePath)
    .then(content => mainContent.innerHTML = content)
    .catch(err => mainContent.innerHTML = `<p>Error loading page: ${state.currentView}</p>`);
}

/* ---------- App Renderer ---------- */
function renderApp() {
  if(!state.hasSeenWelcome) { renderWelcomePage(); return; }
  if(!state.isAuthenticated) { renderLoginPage(); return; }

  // Logged-in user
  userName.textContent = state.currentUser.name;
  userEmail.textContent = state.currentUser.email;
  renderMainContent();
}

/* ---------- Event Listeners ---------- */
profileBtn.addEventListener('click', ()=>setView('profile'));
logoutBtn.addEventListener('click', logoutUser);
navButtons.forEach(btn => {
  btn.addEventListener('click', e => setView(e.currentTarget.dataset.view));
});

/* ---------- Initial Render ---------- */
renderApp();
</script>
</body>
</html>

