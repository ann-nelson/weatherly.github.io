<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weatherly - Past Weather</title>
<link rel="stylesheet" href="stylesheet/global.css">
<link rel="stylesheet" href="stylesheet/pastWeather.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="mockdata.js"></script>
</head>
<body>

<!-- Top Navigation -->
<header class="top-nav">
  <div class="logo">☁️ Weatherly</div>
  <nav class="nav-links">
    <a href="saved.html">Dashboard</a>
    <a href="search.html">Search</a>
    <a href="pastWeather.html" class="active">Past Weather</a>
    <a href="weatherAlerts.html">Alerts</a>
    <a href="settings.html">Settings</a>
    <a href="help.html">Help</a>
  </nav>
  <div class="user-section">
    <button onclick="window.location.href='profile.html'" class="profile-btn">Demo User</button>
    <button onclick="window.location.href='login.html'" class="logout-btn">Logout</button>
  </div>
</header>

<main class="main-container">
  <header class="section-header">
    <h1>Past Weather Data</h1>
    <p>View and compare historical weather information</p>
  </header>

  <!-- Controls -->
  <div class="controls-grid">
    <div class="card">
      <label for="timeRange">Time Range:</label>
      <select id="timeRange">
        <option value="7days">Last 7 Days</option>
        <option value="14days">Last 14 Days</option>
        <option value="30days">Last 30 Days</option>
        <option value="90days">Last 90 Days</option>
      </select>
    </div>

    <div class="card">
      <label for="location1">Location 1:</label>
      <select id="location1"></select>
      <label for="location2">Location 2:</label>
      <select id="location2"></select>
    </div>
  </div>

  <!-- Charts -->
  <div class="charts-grid">
    <!-- Location 1 Charts -->
    <div class="card">
      <h3>Temperature Trend</h3>
      <p class="chart-subtitle" id="tempSubtitle"></p>
      <canvas id="tempChart" height="300"></canvas>
    </div>
    <div class="card">
      <h3>Precipitation History</h3>
      <p class="chart-subtitle" id="precipSubtitle"></p>
      <canvas id="precipChart" height="250"></canvas>
    </div>
    <div class="card">
      <h3>Humidity Levels</h3>
      <p class="chart-subtitle" id="humiditySubtitle"></p>
      <canvas id="humidityChart" height="200"></canvas>
    </div>
    <div class="card">
      <h3>Wind Speed</h3>
      <p class="chart-subtitle" id="windSubtitle"></p>
      <canvas id="windChart" height="200"></canvas>
    </div>
    
    <!-- Location 2 Charts -->
    <div class="card">
      <h3>Temperature Trend</h3>
      <p class="chart-subtitle" id="tempSubtitle2"></p>
      <canvas id="tempChart2" height="300"></canvas>
    </div>
    <div class="card">
      <h3>Precipitation History</h3>
      <p class="chart-subtitle" id="precipSubtitle2"></p>
      <canvas id="precipChart2" height="250"></canvas>
    </div>
    <div class="card">
      <h3>Humidity Levels</h3>
      <p class="chart-subtitle" id="humiditySubtitle2"></p>
      <canvas id="humidityChart2" height="200"></canvas>
    </div>
    <div class="card">
      <h3>Wind Speed</h3>
      <p class="chart-subtitle" id="windSubtitle2"></p>
      <canvas id="windChart2" height="200"></canvas>
    </div>
    
    <!-- Comparison Chart -->
    <div class="card">
      <h3>Compare Locations</h3>
      <p class="chart-subtitle" id="comparisonSubtitle"></p>
      <canvas id="comparisonChart" height="300"></canvas>
    </div>
  </div>
</main>

<script>
// Get locations and historical data function from mockdata.js
const locations = window.pastWeatherLocations || [];
const getHistoricalData = window.getPastWeatherHistoricalData || function() { return []; };

const location1Select = document.getElementById('location1');
const location2Select = document.getElementById('location2');
const timeRangeSelect = document.getElementById('timeRange');
const tempSubtitle = document.getElementById('tempSubtitle');
const precipSubtitle = document.getElementById('precipSubtitle');
const humiditySubtitle = document.getElementById('humiditySubtitle');
const windSubtitle = document.getElementById('windSubtitle');
const tempSubtitle2 = document.getElementById('tempSubtitle2');
const precipSubtitle2 = document.getElementById('precipSubtitle2');
const humiditySubtitle2 = document.getElementById('humiditySubtitle2');
const windSubtitle2 = document.getElementById('windSubtitle2');
const comparisonSubtitle = document.getElementById('comparisonSubtitle');

locations.forEach(loc => {
  location1Select.innerHTML += `<option value="${loc.id}">${loc.name}, ${loc.country}</option>`;
  location2Select.innerHTML += `<option value="${loc.id}">${loc.name}, ${loc.country}</option>`;
});

let selectedLocation1 = locations[0].id;
let selectedLocation2 = locations[1].id;
let timeRange = timeRangeSelect.value;

location1Select.value = selectedLocation1;
location2Select.value = selectedLocation2;

function generateHistoricalData(locationId, timeRange) {
  // Get static data from mockdata.js
  return getHistoricalData(locationId, timeRange);
}

function generateComparisonData(loc1, loc2, timeRange) {
  const data1 = generateHistoricalData(loc1, timeRange);
  const data2 = generateHistoricalData(loc2, timeRange);
  return data1.map((item, idx) => ({
    date: item.date,
    location1: item.temp,
    location2: data2[idx]?.temp || item.temp
  }));
}

let tempChart, precipChart, humidityChart, windChart;
let tempChart2, precipChart2, humidityChart2, windChart2;
let comparisonChart;

function renderLocation1Charts() {
  const historicalData1 = generateHistoricalData(selectedLocation1, timeRange);
  const loc1 = locations.find(l => l.id === selectedLocation1);
  const labels = historicalData1.map(d => d.date);
  
  const tempHigh1 = historicalData1.map(d => d.high);
  const tempAvg1 = historicalData1.map(d => d.temp);
  const tempLow1 = historicalData1.map(d => d.low);
  const precipitation1 = historicalData1.map(d => d.precipitation);
  const humidity1 = historicalData1.map(d => d.humidity);
  const wind1 = historicalData1.map(d => d.windSpeed);

  // Update chart subtitles
  if (loc1) {
    if (tempSubtitle) tempSubtitle.textContent = `Location 1: ${loc1.name}, ${loc1.country}`;
    if (precipSubtitle) precipSubtitle.textContent = `Location 1: ${loc1.name}, ${loc1.country}`;
    if (humiditySubtitle) humiditySubtitle.textContent = `Location 1: ${loc1.name}, ${loc1.country}`;
    if (windSubtitle) windSubtitle.textContent = `Location 1: ${loc1.name}, ${loc1.country}`;
  }

  // Destroy Location 1 charts
  [tempChart, precipChart, humidityChart, windChart].forEach(c => c?.destroy());

  // Location 1 Charts
  tempChart = new Chart(document.getElementById('tempChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'High', data: tempHigh1, borderColor: '#ef4444', fill: false, borderDash: [5, 5] },
      { label: 'Average', data: tempAvg1, borderColor: '#3b82f6', fill: true, backgroundColor: 'rgba(59,130,246,0.3)' },
      { label: 'Low', data: tempLow1, borderColor: '#6366f1', fill: false, borderDash: [5, 5] }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });

  precipChart = new Chart(document.getElementById('precipChart'), {
    type: 'bar',
    data: { labels, datasets: [
      { label: 'Precipitation (%)', data: precipitation1, backgroundColor: '#06b6d4' }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });

  humidityChart = new Chart(document.getElementById('humidityChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Humidity (%)', data: humidity1, borderColor: '#3b82f6', fill: false }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });

  windChart = new Chart(document.getElementById('windChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Wind (mph)', data: wind1, borderColor: '#10b981', fill: false }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });
}

function renderLocation2Charts() {
  const historicalData2 = generateHistoricalData(selectedLocation2, timeRange);
  const loc2 = locations.find(l => l.id === selectedLocation2);
  const labels = historicalData2.map(d => d.date);
  
  const tempHigh2 = historicalData2.map(d => d.high + "°F");
  const tempAvg2 = historicalData2.map(d => d.temp); + "°F"
  const tempLow2 = historicalData2.map(d => d.low + "°F");
  const precipitation2 = historicalData2.map(d => d.precipitation);
  const humidity2 = historicalData2.map(d => d.humidity);
  const wind2 = historicalData2.map(d => d.windSpeed);

  // Update chart subtitles
  if (loc2) {
    if (tempSubtitle2) tempSubtitle2.textContent = `Location 2: ${loc2.name}, ${loc2.country}`;
    if (precipSubtitle2) precipSubtitle2.textContent = `Location 2: ${loc2.name}, ${loc2.country}`;
    if (humiditySubtitle2) humiditySubtitle2.textContent = `Location 2: ${loc2.name}, ${loc2.country}`;
    if (windSubtitle2) windSubtitle2.textContent = `Location 2: ${loc2.name}, ${loc2.country}`;
  }

  // Destroy Location 2 charts
  [tempChart2, precipChart2, humidityChart2, windChart2].forEach(c => c?.destroy());

  // Location 2 Charts
  tempChart2 = new Chart(document.getElementById('tempChart2'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'High', data: tempHigh2, borderColor: '#f97316', fill: false, borderDash: [5, 5] },
      { label: 'Average', data: tempAvg2, borderColor: '#8b5cf6', fill: true, backgroundColor: 'rgba(139,92,246,0.3)' },
      { label: 'Low', data: tempLow2, borderColor: '#ec4899', fill: false, borderDash: [5, 5] }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });

  precipChart2 = new Chart(document.getElementById('precipChart2'), {
    type: 'bar',
    data: { labels, datasets: [
      { label: 'Precipitation (%)', data: precipitation2, backgroundColor: '#8b5cf6' }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });

  humidityChart2 = new Chart(document.getElementById('humidityChart2'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Humidity (%)', data: humidity2, borderColor: '#8b5cf6', fill: false }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });

  windChart2 = new Chart(document.getElementById('windChart2'), {
    type: 'line',
    data: { labels, datasets: [
      { label: 'Wind (mph)', data: wind2, borderColor: '#8b5cf6', fill: false }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });
}

function renderComparisonChart() {
  const comparisonData = generateComparisonData(selectedLocation1, selectedLocation2, timeRange);
  const loc1 = locations.find(l => l.id === selectedLocation1);
  const loc2 = locations.find(l => l.id === selectedLocation2);
  const labels = comparisonData.map(d => d.date);
  
  const comparison1 = comparisonData.map(d => d.location1);
  const comparison2 = comparisonData.map(d => d.location2);

  // Update comparison subtitle
  if (loc1 && loc2 && comparisonSubtitle) {
    comparisonSubtitle.textContent =
      `Comparing Location 1 (${loc1.name}, ${loc1.country}) – blue line – ` +
      `with Location 2 (${loc2.name}, ${loc2.country}) – purple line.`;
  }

  // Destroy comparison chart
  if (comparisonChart) comparisonChart.destroy();

  // Comparison Chart
  comparisonChart = new Chart(document.getElementById('comparisonChart'), {
    type: 'line',
    data: { labels, datasets: [
      { label: loc1 ? loc1.name : 'Location 1', data: comparison1, borderColor: '#3b82f6', fill: false },
      { label: loc2 ? loc2.name : 'Location 2', data: comparison2, borderColor: '#8b5cf6', fill: false }
    ]},
    options: { responsive: true, plugins: { legend: { position: 'top' } } }
  });
}

function renderAllCharts() {
  renderLocation1Charts();
  renderLocation2Charts();
  renderComparisonChart();
}

location1Select.addEventListener('change', e => { 
  selectedLocation1 = e.target.value; 
  renderLocation1Charts();
  renderComparisonChart();
});

location2Select.addEventListener('change', e => { 
  selectedLocation2 = e.target.value; 
  renderLocation2Charts();
  renderComparisonChart();
});

timeRangeSelect.addEventListener('change', e => { 
  timeRange = e.target.value; 
  renderAllCharts();
});

renderAllCharts();
</script>

</body>
</html>
